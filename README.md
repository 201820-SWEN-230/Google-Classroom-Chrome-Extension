# Apps Script API Extension

- Google Classroom instructor downloads google chrome extensions made by design spine team
- The instructor authenticates the extension and is asked to approve the extensions access to google classroom
- This authentication token is saved and used when calling the script which is stored on the google cloud.
- The instructor clicks on the google extension icon causing a popup to appear. 
- The instructor clicks on the “populate assignments” button. This will call the script hosted on the google cloud. It will specifically call the createAssignments function which will use google classrooms api to create all of the coursework objects and populate them with CAOA’s assignments.
- Following student(s) submitting an assignment the instructor grades the student(s) assignment(s) and release the grades
- After grading the instructor clicks on the google extension icon and then on the “advance students” button. This will call the google script and will specifically call the checkAll() function. 


## Google apps script
studentSubmissions() is a helper function to checkAll() that pulls the submissions associated with a coursework object and checks the grade for that submission. If the grade is passing the function adds the student id associated with that submission to an array called sidsp (student ids passing). If the grade is not passing or does not exists, the function adds the student id to an array called sidsf (student ids failing). After looping through all of the submissions, this function will return a tuple with both sidsp and sidsf.
	
assignNext() is a helper function to checkAll(). This function is passed a courseWork object and a tuple of two arrays containing student ids. assignNext() checks if the courseWork object is published, and if it isn’t it publishes it. 
Then it checks to see if both the passing student id list and the failing id list are not empty. If they are not empty, then assignNext will call the modifyAssignees method of Google classrooms API. This method requires that you set the objects assigneeMode to INDIVIDUAL_STUDENTS before adding and removing student ids. Something to note is that you cannot just add student ids or just remove student ids. If you call this method you have to have at least one id in each option.
This is why if that fails assignNext checks to see if the passing student id list is not empty while the failing id list is. If this is the case, it means that every single student has received a passing grade on the assignment and is ready to move on. If this passes, assignNext still calls modifyAssignees, but only sets assigneeMode to ALL_STUDENTS. Google classroom will then add all of the students to this coursework object.

checkAll() is a function on the google apps script that will check all of the students in the class and move them on incrementally. It does this by pulling the list of coursework currently in the classroom. It then iterates through each coursework object. This loop will start on the last item in the coursework list and end on the second object. The reason it starts on the last object is because that object will actually correspond to lesson 1 in google classroom. The reason the first item in the coursework list is left off is because this corresponds to the last lesson before the drafted assignments, which are stored in a separate list. This object is checked separately because checkAll() will need to search the drafted assignments for the next assignment, instead of being able to just call assignNext with the next coursework object in the published list.

In the initial for loop, checkAll will call studentSubmissions() on each coursework object. studentSumissions() will return a tuple with two arrays of student ids in it; the first is the student ids that passed with assignment, the second is the student ids that failed or have not completed the assignment. checkAll() will concat this array and cross reference this list with the list of all students in the class. If a student in allstudents is not in the concated list, that student id is added to the student ids that failed list. The reason this is necessary is because since each student can move through the class individually, there is a scenario where there is a single student on lesson 2 and the rest of the class is still on lesson 1. If studentSubmission is called on lesson 2, assuming that student passed, studentSubmissions will return the passing array, which will be of length one, and the failing array of length 0. If assignNext is then called on lesson 3 with those two lists of student ids, assignNext will see that the second array is of length 0 and call modifyAssignnees and set assigneeMode to ALL_STUDENTS. To avoid this checkAll will simply add all of the students who are in the class but not assigned to that lesson to the ids that failed list. After checkAll() cross references with the all students list, assignNext is called on the next coursework object and is passed that tuple of student ids.

After checkAll() is finished with that initial for loop, it then checks the first item in the coursework list, which corresponds to the last published assignment in google classroom. If no students have passed, checkAll does nothing. This is because if it calls assignNext on a drafted assignment, assignNext will automatically publish that assignment. If an assignment is published, google classroom automatically adds all of the students to this new assignment. If there are passing student Ids, checkAll gets the last item in the drafted assignment list, which will correspond to the first drafted assignment.


